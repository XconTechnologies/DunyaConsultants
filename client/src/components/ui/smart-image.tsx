import { ImgHTMLAttributes } from 'react';
import { extractAltText } from '@/lib/image-utils';

interface SmartImageProps extends Omit<ImgHTMLAttributes<HTMLImageElement>, 'alt'> {
  src: string;
  alt?: string; // Optional - will be auto-generated from filename if not provided
  title?: string; // Optional - used as alt if provided, otherwise auto-generated
  priority?: boolean; // Custom prop for eager loading (not passed to img tag)
}

/**
 * Smart Image Component
 * Automatically detects and assigns alt text from filename or title if not provided
 * Serves images as WebP format for better performance
 * 
 * Priority order for alt text:
 * 1. Explicitly provided alt prop
 * 2. Title prop (if provided)
 * 3. Auto-generated from filename
 * 
 * @example
 * // Alt text auto-generated from filename
 * <SmartImage src="/api/uploads/best-study-abroad-consultants_123456.webp" />
 * // Result: alt="Best Study Abroad Consultants"
 * 
 * @example
 * // Custom alt text
 * <SmartImage src="/api/uploads/image.webp" alt="Custom description" />
 * // Result: alt="Custom description"
 * 
 * @example
 * // Using title as alt
 * <SmartImage src="/api/uploads/image.webp" title="Image Title" />
 * // Result: alt="Image Title" title="Image Title"
 */
export function SmartImage({ src, alt, title, priority, ...props }: SmartImageProps) {
  // Priority: alt prop > title prop > auto-generated from filename
  // If no alt is assigned, auto-detect the title from filename
  const autoGeneratedAlt = extractAltText(src);
  const finalAlt = alt || title || autoGeneratedAlt;
  
  // Use title if provided, otherwise use the auto-generated alt as title
  const finalTitle = title || autoGeneratedAlt;
  
  return (
    <img
      src={src}
      alt={finalAlt}
      title={finalTitle}
      loading={priority ? "eager" : "lazy"}
      {...(priority ? { fetchpriority: "high" } : {})}
      {...props}
    />
  );
}

export default SmartImage;
